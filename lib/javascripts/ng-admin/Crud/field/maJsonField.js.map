{"version":3,"sources":["../../../../../src/javascripts/ng-admin/Crud/field/maJsonField.js"],"names":["maJsonField","codemirror","require","stableStringify","global","jsonlint","defineOption","CodeMirror","scope","restrict","link","element","field","name","v","validation","jsonValue","value","angular","toJson","input","children","attributes","setAttribute","manuallyEnteredValueJSON","$watch","onValueChanged","fromJson","e","template","$inject"],"mappings":";;;;;kBA4BwBA,W;AA5BxB,IAAIC,aAAaC,QAAQ,YAAR,CAAjB;AACA,IAAIC,kBAAkBD,QAAQ,uBAAR,CAAtB;;AAEAE,OAAOC,QAAP,GAAkBH,QAAQ,0BAAR,CAAlB;;AAEAA,QAAQ,qCAAR;AACAA,QAAQ,qCAAR;AACAA,QAAQ,4BAAR;AACAA,QAAQ,iCAAR;AACAA,QAAQ,wCAAR;AACAA,QAAQ,uCAAR;;AAEAD,WAAWK,YAAX,CAAwB,eAAxB,EAAyC,IAAzC;AACAL,WAAWK,YAAX,CAAwB,mBAAxB,EAA6C,IAA7C;AACAL,WAAWK,YAAX,CAAwB,cAAxB,EAAwC,IAAxC;AACAL,WAAWK,YAAX,CAAwB,SAAxB,EAAmC,CAAnC;AACAL,WAAWK,YAAX,CAAwB,MAAxB,EAAgC,kBAAhC;AACAL,WAAWK,YAAX,CAAwB,SAAxB,EAAmC,CAAC,yBAAD,CAAnC;AACAL,WAAWK,YAAX,CAAwB,MAAxB,EAAgC,IAAhC;AACAL,WAAWK,YAAX,CAAwB,iBAAxB,EAA2C,IAA3C;;AAEAF,OAAOG,UAAP,GAAoBN,UAApB;;AAEA;;;;;AAKe,SAASD,WAAT,GAAuB;AAClC,WAAO;AACHQ,eAAO;AACH,qBAAS,GADN;AAEH,qBAAS;AAFN,SADJ;AAKHC,kBAAU,GALP;AAMHC,cAAM,cAASF,KAAT,EAAgBG,OAAhB,EAAyB;AAC3B,gBAAIC,QAAQJ,MAAMI,KAAN,EAAZ;AACAJ,kBAAMK,IAAN,GAAaD,MAAMC,IAAN,EAAb;AACAL,kBAAMM,CAAN,GAAUF,MAAMG,UAAN,EAAV;AACAP,kBAAMQ,SAAN,GAAkBR,MAAMS,KAAN,KAAgB,IAAhB,GAAuB,EAAvB,GAA4BC,QAAQC,MAAR,CAAeX,MAAMS,KAArB,EAA4B,IAA5B,CAA9C;AACA,gBAAIG,QAAQT,QAAQU,QAAR,GAAmB,CAAnB,CAAZ;AACA,gBAAIC,aAAaV,MAAMU,UAAN,EAAjB;AACA,iBAAK,IAAIT,IAAT,IAAiBS,UAAjB,EAA6B;AACzBF,sBAAMG,YAAN,CAAmBV,IAAnB,EAAyBS,WAAWT,IAAX,CAAzB;AACH;;AAEDL,kBAAMgB,wBAAN,GAAiCrB,gBAAgBK,MAAMS,KAAtB,CAAjC;;AAEAT,kBAAMiB,MAAN,CAAa,OAAb,EAAsB,UAAUR,KAAV,EAAiB;AACnC,oBAAGd,gBAAgBc,KAAhB,MAA2BT,MAAMgB,wBAApC,EAA8D;AAC1D;AACH;AACDhB,sBAAMQ,SAAN,GAAkBC,UAAU,IAAV,GAAiB,EAAjB,GAAsBC,QAAQC,MAAR,CAAeF,KAAf,EAAsB,IAAtB,CAAxC;AACH,aALD,EAKG,IALH;;AAOAT,kBAAMkB,cAAN,GAAuB,YAAW;AAC9B,oBAAIV,YAAYR,MAAMQ,SAAtB;AACA,oBAAIA,aAAa,EAAb,IAAmB,OAAOA,SAAP,KAAqB,WAA5C,EAAyD;AACrDR,0BAAMgB,wBAAN,GAAiCrB,gBAAgB,IAAhB,CAAjC;AACAK,0BAAMS,KAAN,GAAc,IAAd;AACA;AACH;AACD,oBAAI;AACA,wBAAIA,QAAQC,QAAQS,QAAR,CAAiBX,SAAjB,CAAZ;AACAR,0BAAMgB,wBAAN,GAAiCrB,gBAAgBc,KAAhB,CAAjC;AACAT,0BAAMS,KAAN,GAAcA,KAAd;AACH,iBAJD,CAIE,OAAOW,CAAP,EAAU;AACR;AACH;AACJ,aAdD;AAeH,SAzCE;AA0CHC,kBACR,4JACA;AA5CW,KAAP;AA8CH;;AAED7B,YAAY8B,OAAZ,GAAsB,EAAtB","file":"maJsonField.js","sourcesContent":["var codemirror = require('codemirror');\nvar stableStringify = require('json-stable-stringify');\n\nglobal.jsonlint = require('jsonlint/web/jsonlint.js');\n\nrequire('codemirror/addon/edit/closebrackets');\nrequire('codemirror/addon/edit/matchbrackets');\nrequire('codemirror/addon/lint/lint');\nrequire('codemirror/addon/lint/json-lint');\nrequire('codemirror/addon/selection/active-line');\nrequire('codemirror/mode/javascript/javascript');\n\ncodemirror.defineOption(\"matchBrackets\", true);\ncodemirror.defineOption(\"autoCloseBrackets\", true);\ncodemirror.defineOption(\"lineWrapping\", true);\ncodemirror.defineOption(\"tabSize\", 2);\ncodemirror.defineOption(\"mode\", \"application/json\");\ncodemirror.defineOption(\"gutters\", [\"CodeMirror-lint-markers\"]);\ncodemirror.defineOption(\"lint\", true);\ncodemirror.defineOption(\"styleActiveLine\", true);\n\nglobal.CodeMirror = codemirror;\n\n/**\n * Edition field for a JSON string in a textarea.\n *\n * @example <ma-json-field field=\"field\" value=\"value\"></ma-json-field>\n */\nexport default function maJsonField() {\n    return {\n        scope: {\n            'field': '&',\n            'value': '='\n        },\n        restrict: 'E',\n        link: function(scope, element) {\n            var field = scope.field();\n            scope.name = field.name();\n            scope.v = field.validation();\n            scope.jsonValue = scope.value === null ? '' : angular.toJson(scope.value, true);\n            var input = element.children()[0];\n            var attributes = field.attributes();\n            for (var name in attributes) {\n                input.setAttribute(name, attributes[name]);\n            }\n\n            scope.manuallyEnteredValueJSON = stableStringify(scope.value);\n\n            scope.$watch('value', function (value) {\n                if(stableStringify(value) === scope.manuallyEnteredValueJSON) {\n                    return;\n                }\n                scope.jsonValue = value === null ? '' : angular.toJson(value, true);\n            }, true);\n            \n            scope.onValueChanged = function() {\n                var jsonValue = scope.jsonValue;\n                if (jsonValue == '' || typeof jsonValue === 'undefined') {\n                    scope.manuallyEnteredValueJSON = stableStringify(null);\n                    scope.value = null;\n                    return;\n                }\n                try {\n                    var value = angular.fromJson(jsonValue);\n                    scope.manuallyEnteredValueJSON = stableStringify(value);\n                    scope.value = value;\n                } catch (e) {\n                    // incorrect JSON, do not convert back to value\n                }\n            }\n        },\n        template:\n'<textarea ui-codemirror ng-change=\"onValueChanged()\" ng-model=\"jsonValue\" id=\"{{ name }}\" name=\"{{ name }}\" ng-required=\"v.required\" ma-json-validator>' +\n'</textarea>'\n    };\n}\n\nmaJsonField.$inject = [];\n"]}